source ~/.vimrc

if has('ide')
	set clipboard+=unnamed
	set clipboard+=ideaput
	" Smart join for <C-J>
	set ideajoin
	set ideamarks
	set idearefactormode=keep
	" Ideavim Extension for switching to English in normal"
	let g:KeepEnglishName_package_name_package_name = "org.sil.ukelele.keyboardlayout.abcnl.abcnl"
	set keep-english-in-normal-and-restore-in-insert
	" Ideavim Extension for switching to English in normal"

	" Config manipulations
	nnoremap \e :e ~/.ideavimrc<CR>
	nnoremap \r :action IdeaVim.ReloadVimRc.reload<CR>
	" Config manipulations

	" Focus last buffer
	nnoremap <leader><Tab>    <C-S-6>
	vnoremap <leader><Tab>    <Esc><C-S-6>

	" Open in terminal
	nnoremap <leader>te    :action Terminal.OpenInTerminal<CR>
	vnoremap <leader>te    :action Terminal.OpenInTerminal<CR>

	nnoremap <leader>tt    :action ActivateTerminalToolWindow<CR>
	vnoremap <leader>tt    :action ActivateTerminalToolWindow<CR>

	nnoremap <leader>*    :action ShowUsages<CR>
	vnoremap <leader>*    :action ShowUsages<CR>

	" Project recent
	nnoremap <leader>pr    :action RecentFiles<CR>
	vnoremap <leader>pr    :action RecentFiles<CR>

	" Project save
	nnoremap <leader>ps    :action SaveAll<CR>
	vnoremap <leader>ps    :action SaveAll<CR>

	" Copy project file path
	nnoremap <leader>pfy    :action CopyAbsolutePath<CR>
	vnoremap <leader>pfy    :action CopyAbsolutePath<CR>

	" Project new file
	nnoremap <leader>pfn    :action NewElementMenu<CR>
	vnoremap <leader>pfn    :action NewElementMenu<CR>

	" -- Colors --
	
	" Pick color
	nnoremap <leader>Cl    :action ShowColorPicker<CR>
	vnoremap <leader>Cl    :action ShowColorPicker<CR>

	" -- Colors --


	" -- Errors --

	" List errors
	nnoremap <leader>el    :action CodeInspection.OnEditor<CR>
	vnoremap <leader>el    :action CodeInspection.OnEditor<CR>

	" Go to next error
	nnoremap <leader>en    :action GotoNextError<CR>
	vnoremap <leader>en    <Esc>:action GotoNextError<CR>

	" Go to previous error
	nnoremap <leader>ep    :action GotoPreviousError<CR>
	vnoremap <leader>ep    <Esc>:action GotoPreviousError<CR>

	" -- Errors --
	

	" -- Git --

	" Git clone
	nnoremap <leader>gc    :action Git.Clone<CR>
	vnoremap <leader>gc    :action Git.Clone<CR>

	" Show log of current file
	nnoremap <leader>gfl    :action Vcs.ShowTabbedFileHistory<CR>
	vnoremap <leader>gfl    :action Vcs.ShowTabbedFileHistory<CR>
	""" ---------------------------------------------

	" Git init
	nnoremap <leader>gi    :action Git.Init<CR>
	vnoremap <leader>gi    :action Git.Init<CR>

	" Show local changes (git status)
	nnoremap <leader>gs    :action Vcs.Show.Local.Changes<CR>
	vnoremap <leader>gs    :action Vcs.Show.Local.Changes<CR>

	" Update project (git pull)
	nnoremap <leader>gv+    :action Vcs.UpdateProject<CR>
	vnoremap <leader>gv+    :action Vcs.UpdateProject<CR>

	" Annotate. Show when each line was last edited and by whom.
	nnoremap <leader>ga    :action Annotate<CR>
	vnoremap <leader>ga    :action Annotate<CR>

	" Show log (git log)
	nnoremap <leader>gvl    :action Vcs.Show.Log<CR>
	vnoremap <leader>gvl    :action Vcs.Show.Log<CR>

	" -- Git --
	
	" -- Insertions --
	
	" Insert line below
	nnoremap <leader>ij    o<Esc>k
	vnoremap <leader>ij    <Esc>o<Esc>k

	" Insert line above
	nnoremap <leader>ik    O<Esc>j
	vnoremap <leader>ik    <Esc>O<Esc>j

	" -- Insertions --
	

	" -- Changes --

	" Go to next change
	nnoremap g,    :action JumpToNextChange<CR>
	vnoremap g,    :action JumpToNextChange<CR>

	" Go to last change
	nnoremap g;    :action JumpToLastChange<CR>
	vnoremap g;    :action JumpToLastChange<CR>

	" Collapse all folds
	nnoremap zm    :action CollapseAllRegions<CR>
	vnoremap zm    :action CollapseAllRegions<CR>

	" Open all folds
	nnoremap zr    :action ExpandAllRegions<CR>
	vnoremap zr    :action ExpandAllRegions<CR>

	" -- Changes --


	" -- Numbers --

	" Increment number.
	" As usual you can press '.' to repeat this action again.
	nnoremap <leader>n+    <C-a>
	vnoremap <leader>n+    <C-a>
	nnoremap <leader>n=    <C-a>
	vnoremap <leader>n=    <C-a>

	" Decrement number.
	" As usual you can press '.' to repeat this action again.
	nnoremap <leader>n-    <C-x>
	vnoremap <leader>n-    <C-x>

	" -- Numbers --
	

	" -- Project --

	" Close project
	nnoremap <leader>qf    :action CloseProject<CR>
	vnoremap <leader>qf    <Esc>:action CloseProject<CR>
	nnoremap <leader>qq    :action CloseProject<CR>
	vnoremap <leader>qq    <Esc>:action CloseProject<CR>

	" Exit (close all projects)
	nnoremap <leader>qQ    :action Exit<CR>
	vnoremap <leader>qQ    <Esc>:action Exit<CR>

	" Restart
	nnoremap <leader>qR    :action InvalidateCaches<CR>
	vnoremap <leader>qR    <Esc>:action InvalidateCaches<CR>
	nnoremap <leader>qr    :action RestartIde<CR>
	vnoremap <leader>qr    <Esc>:action RestartIde<CR>

	" Save all and close project
	nnoremap <leader>qs    :action SaveAll<CR>:action CloseProject<CR>
	vnoremap <leader>qs    <Esc>:action SaveAll<CR>:action CloseProject<CR>

	" -- Project --
	
	" -- Windows  --

	" Split window right
	nnoremap <leader>w/    :action SplitVertically<CR>
	vnoremap <leader>w/    <Esc>:action SplitVertically<CR>
	nnoremap <leader>wv    :action SplitVertically<CR>
	vnoremap <leader>wv    <Esc>:action SplitVertically<CR>

	" Split window below
	nnoremap <leader>w-    :action SplitHorizontally<CR>
	vnoremap <leader>w-    <Esc>:action SplitHorizontally<CR>
	nnoremap <leader>ws    :action SplitHorizontally<CR>
	vnoremap <leader>ws    <Esc>:action SplitHorizontally<CR>

	" Close window
	nnoremap <leader>wd    :action CloseAllEditors<CR>
	vnoremap <leader>wd    <Esc>:action CloseAllEditors<CR>
	nnoremap <leader>wx    :action CloseAllEditors<CR>
	vnoremap <leader>wx    <Esc>:action CloseAllEditors<CR>

	" Focus window left
	nnoremap <leader>wh         <C-w>h
	vnoremap <leader>wh         <Esc><C-w>h
	nnoremap <leader>w<Left>    <C-w>h
	vnoremap <leader>w<Left>    <Esc><C-w>h

	" Focus window down
	nnoremap <leader>wj         <C-w>j
	vnoremap <leader>wj         <Esc><C-w>j
	nnoremap <leader>w<Down>    <C-w>j
	vnoremap <leader>w<Down>    <Esc><C-w>j

	" Focus window up
	nnoremap <leader>wk       <C-w>k
	vnoremap <leader>wk       <Esc><C-w>k
	nnoremap <leader>w<Up>    <C-w>k
	vnoremap <leader>w<Up>    <Esc><C-w>k

	" Focus window right
	nnoremap <leader>wl          <C-w>l
	vnoremap <leader>wl          <Esc><C-w>l
	nnoremap <leader>w<Right>    <C-w>l
	vnoremap <leader>w<Right>    <Esc><C-w>l

	" Focus next project
	nnoremap <leader>wo    :action NextProjectWindow<CR>
	vnoremap <leader>wo    :action NextProjectWindow<CR>

	" Split window below and focus
	nnoremap <leader>wS    <C-w>s<C-w>j
	vnoremap <leader>wS    <Esc><C-w>s<C-w>j

	" Split window right and focus
	nnoremap <leader>wV    <C-w>v<C-w>l
	vnoremap <leader>wV    <Esc><C-w>v<C-w>l

	" Focus next window
	nnoremap <leader>ww    :action NextSplitter<CR>
	vnoremap <leader>ww    <Esc>:action NextSplitter<CR>
	
	" -- Windows  --
	
	" -- Zoom  --

	" Increase font size
	nnoremap <leader>zx+    :action EditorIncreaseFontSize<CR>
	vnoremap <leader>zx+    :action EditorIncreaseFontSize<CR>
	nnoremap <leader>zx=    :action EditorIncreaseFontSize<CR>
	vnoremap <leader>zx=    :action EditorIncreaseFontSize<CR>

	" Decrease font size
	nnoremap <leader>zx-    :action EditorDecreaseFontSize<CR>
	vnoremap <leader>zx-    :action EditorDecreaseFontSize<CR>

	" Reset font size
	nnoremap <leader>zx0    :action EditorResetFontSize<CR>
	vnoremap <leader>zx0    :action EditorResetFontSize<CR>

	" -- Zoom  --

	" IDE menus
	map <leader>mg <Action>(Git.MainMenu)

	map <leader>mp <Action>(ManageRecentProjects)
	map <leader>mn <Action>(ShowNavBar)
	map <leader>mv <Action>(ActivateProjectToolWindow)
	map <leader>ml <Action>(SelectInProjectView)

	map <leader>mr <Action>(ChooseRunConfiguration)
	map <leader>mR <Action>(RunClass)
	map <leader>md <Action>(ChooseDebugConfiguration)

	map <leader>ms <Action>(SurroundWithLiveTemplate)
	map <leader>mm <Action>(osmedile.intellij.stringmanip.PopupChoiceAction)

	map <leader>mo <Action>(FileStructurePopup)
	map <leader>mu <Action>(FindUsagesMenuGroup)
	map <leader>mc <Action>(CallHierarchy)

	map <leader>mh <Action>(LocalHistory.ShowHistory)

	" Menu of events (Show event log)
	nnoremap <leader>me    :action ActivateEventLogToolWindow<CR>
	vnoremap <leader>me    :action ActivateEventLogToolWindow<CR>

	" Menu of bookmarks
	nnoremap <leader>mb    :action ShowBookmarks<CR>
	vnoremap <leader>mb    :action ShowBookmarks<CR>

	" IDE menus

	" Hover mapping
	map gj <Action>(ShowErrorDescription)
	map gh <Action>(QuickJavaDoc)
	map gt <Action>(QuickTypeDefinition)
	map ge <Action>(EditSource)
	" map ge <Action>(Documentation.EditSource)

	" Find action
	nnoremap <leader>fa    :action GotoAction<CR>
	vnoremap <leader>fa    :action GotoAction<CR>

	" Find file
	nnoremap <leader>ff    :action GotoFile<CR>
	vnoremap <leader>ff    :action GotoFile<CR>

	" Find in path (globally)
	nnoremap <leader>fg    :action FindInPath<CR>
	vnoremap <leader>fg    :action FindInPath<CR>

	" Find symbol
	nnoremap <leader>fs    :action GotoSymbol<CR>
	vnoremap <leader>fs    :action GotoSymbol<CR>

	" Refactoring
	map <leader>rn <Action>(RenameElement)
	map <leader>rf :action RenameFile<CR>
	map <leader>rr <Action>(ReformatCode)
	map <leader>rR <Action>(ReformatWithPrettierAction)
	map <leader>re <Action>(Javascript.Linters.EsLint.Fix)
	map <leader>rs <Action>(Tool_External Tools_Stylelint.Fix)
	map <leader>ri <Action>(OptimizeImports)
	map <leader>rt <Action>(Refactorings.QuickListPopupAction)
	" Refactoring

	map <leader>a <Action>(Annotate)
	map <leader>b <Action>(ToggleLineBreakpoint)

	" built-in navigation to navigated items works better
	nmap <c-o> <Action>(Back)
	nmap <c-i> <Action>(Forward)
	" but preserve ideavim defaults
	nnoremap g<c-o> <c-o>
	nnoremap g<c-i> <c-i>

	" built in search
	xnoremap g/ :action Find<cr>
	noremap g/ :action Find<cr>

endif
